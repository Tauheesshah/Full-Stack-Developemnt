<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cart</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js" integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI" crossorigin="anonymous"></script>
    <style>
        body {
    background-color: #f8f9fa;
    padding: 20px;
    font-family: Arial, sans-serif;
}

/* Heading */
h1 {
    text-align: center;
    margin-bottom: 20px;
}

/* Table */
table {
    width: 100%;
    background: #ffffff;
    border-collapse: collapse;
    border-radius: 8px;
    overflow: hidden;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.08);
}

/* Table Header */
thead {
    background-color: #212529;
    color: #ffffff;
}

thead th {
    padding: 12px;
    font-weight: 500;
    text-align: center;
}

/* Table Body */
tbody td {
    padding: 12px;
    text-align: center;
    vertical-align: middle;
    border-bottom: 1px solid #e9ecef;
}

/* Product Image */
tbody img {
    width: 60px;
    height: 60px;
    object-fit: cover;
    border-radius: 6px;
}

/* Action Buttons */
tbody button {
    border: none;
    padding: 6px 10px;
    margin: 0 4px;
    border-radius: 5px;
    cursor: pointer;
    background-color: #dee2e6;
}

tbody button:hover {
    background-color: #ced4da;
}

/* Icons */
tbody i {
    font-size: 14px;
}

/* Price column */
tbody td:last-child {
    font-weight: bold;
    color: #198754;
}
.cart-container {
    display: flex;
    gap: 20px;
    justify-content: space-around;
}

td > button {
    width: 46px
}
/* Total box */
.total-box {
    width: 30%;
    background: #ffffff;
    padding: 20px;
    border-radius: 8px;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.08);
    height: fit-content;
}

.total-box h4 {
    margin-bottom: 10px;
}

.total-box p,
.total-box h5 {
    display: flex;
    justify-content: space-between;
    font-weight: 500;
}

.total-box h5 {
    color: #198754;
    margin-top: 10px;
}

/* Checkout button */
.checkout-btn {
    width: 100%;
    margin-top: 15px;
    padding: 10px;
    background-color: #198754;
    color: white;
    border: none;
    border-radius: 5px;
    font-size: 16px;
    cursor: pointer;
}

.checkout-btn:hover {
    background-color: #157347;
}
.text-center {
    text-align: center !important;
    width: 113%;
}
</style>
    <link rel="stylesheet" href="../index.css">
</head>

<body onload="UI_Cart()">
<nav id="navbar"></nav>
<h1>Cart Details</h1>
<!-- <div class="cart-container">
    <table>
        <thead>
            <tr>
                <th>ID</th>
                <th>Image</th>
                <th>Title</th>
                <th>Category</th>
                <th>Action</th>
                <th>Price</th>
            </tr>
        </thead>
        <tbody id="cartData"></tbody>
    </table>

    <div class="total-box">
        <h4>Price Details</h4>
        <hr>

        <p>Subtotal: <span id="subTotal">â‚¹ 0</span></p>
        <p>GST (18%): <span id="gstAmount">â‚¹ 0</span></p>

        <hr>
        <h5>Total Amount: <span id="grandTotal">â‚¹ 0</span></h5>

        <button class="checkout-btn">Checkout</button>
    </div>

</div> -->


  <div id="cart-root"></div>

<footer id="footer"></footer>
</body>
<!-- <script>
    let getCart = JSON.parse(localStorage.getItem("cartData")) || [];
    const GST_Rate=0.18;
    
    function UI_Cart() {
        const tbody = document.querySelector('#cartData');
        tbody.innerHTML = "";

        let subTotal=0;
        getCart.forEach((el,index) => {
            if (!el.qty) el.qty = 1;
            const price = Number(el.price);
            const itemTotal=el.price*el.qty;
            subTotal+=itemTotal

            const tr = document.createElement('tr');

            tr.innerHTML = `
                <td>${el.id}</td>
                <td><img src="${el.image}" width="60"/></td>
                <td>${el.title}</td>
                <td>${el.category}</td>
                <td>
                    <button onclick="changeQty(${index}, 1)"><i class="bi bi-plus-lg"></i></button>
                    <strong>${el.qty}</strong>
                    <button onclick="changeQty(${index}, -1)"><i class="bi bi-dash-lg"></i></button>
                </td>
                <td>â‚¹ ${itemTotal.toFixed(2)}</td>
            `;

            tbody.appendChild(tr);
        });

        const gstAmount=subTotal*GST_Rate;
        const grandTotal=subTotal+gstAmount

        document.getElementById("subTotal").innerText = `â‚¹ ${subTotal.toFixed(2)}`;
        document.getElementById("gstAmount").innerText = `â‚¹ ${gstAmount.toFixed(2)}`;
        document.getElementById("grandTotal").innerText = `â‚¹ ${grandTotal.toFixed(2)}`;

        localStorage.setItem("cartData", JSON.stringify(getCart));
    }

function changeQty(index,value){
    getCart [index].qty = Number(getCart[index].qty) + value;
    if (getCart [index].qty <= 0) {
        getCart .splice(index, 1);
    }
    UI_Cart();
}
</script> -->
<script>
let getCart = JSON.parse(localStorage.getItem("cartData")) || [];
const GST_RATE = 0.18;




function UI_Cart() {
    const root = document.getElementById("cart-root");
    root.innerHTML = "";

    if (getCart.length === 0) {
        root.innerHTML = `<h4 class="text-center">Your cart is empty</h4>`;
        return;
    }

    let subTotal = 0;

    /* ---------- TABLE ---------- */
    const table = document.createElement("table");
    table.className = "table table-bordered text-center";

    table.innerHTML = `
        <thead class="table-dark">
            <tr>
                <th>ID</th>
                <th>Image</th>
                <th>Title</th>
                <th>Category</th>
                <th>Qty</th>
                <th>Price</th>
            </tr>
        </thead>
        <tbody></tbody>
    `;

    const tbody = table.querySelector("tbody");

    getCart.forEach((el, index) => {
        el.qty = el.qty || 1;
        const itemTotal = el.qty * el.price;
        subTotal += itemTotal;

        const tr = document.createElement("tr");
        tr.innerHTML = `
            <td>${el.id}</td>
            <td><img src="${el.image}" width="60"></td>
            <td>${el.title}</td>
            <td>${el.category}</td>
            <td>
                <button onclick="changeQty(${index},1)" class="btn btn-sm btn-secondary">+</button>
                <strong>${el.qty}</strong>
                <button onclick="changeQty(${index},-1)" class="btn btn-sm btn-secondary">âˆ’</button>
            </td>
            <td>â‚¹ ${itemTotal.toFixed(2)}</td>
        `;
        tbody.appendChild(tr);
    });

    /* ---------- TOTAL BOX ---------- */
    const gstAmount = subTotal * GST_RATE;
    const grandTotal = subTotal + gstAmount;

    const totalBox = document.createElement("div");
    totalBox.className = "total-box";

    totalBox.innerHTML = `
        <h4>Price Details</h4>
        <hr>
        <p>Subtotal <span>â‚¹ ${subTotal.toFixed(2)}</span></p>
        <p>GST (18%) <span>â‚¹ ${gstAmount.toFixed(2)}</span></p>
        <hr>
        <h5>Total <span>â‚¹ ${grandTotal.toFixed(2)}</span></h5>
        <button class="checkout-btn">Checkout</button>
    `;

    /* ---------- LAYOUT ---------- */
    const wrapper = document.createElement("div");
    wrapper.className = "cart-container";

    const tableWrap = document.createElement("div");
    tableWrap.className = "cart-table";
    tableWrap.appendChild(table);

    wrapper.append(tableWrap, totalBox);
    root.appendChild(wrapper);

    localStorage.setItem("cartData", JSON.stringify(getCart));
}

function changeQty(index, value) {
    getCart[index].qty += value;
    if (getCart[index].qty <= 0) {
        getCart.splice(index, 1);
    }
    UI_Cart();
}
</script>

<script type="module">
    import {Navbar,renderAuthUI} from '../Components/Navbar.js'
    document.querySelector("#navbar").innerHTML=Navbar()
    renderAuthUI()
    import {Footer} from '../Components/footer.js'
    document.querySelector('#footer').innerHTML=Footer()

    
    function updateCartCount() {
        const cart = JSON.parse(localStorage.getItem("cartData")) || [];
    
        let totalQty = 0;
        cart.forEach(item => {
            totalQty += Number(item.qty) || 0;
        });
    
        const badge = document.getElementById("cartCount");
        if (!badge) return;
    
        badge.innerText = totalQty;
        badge.style.display = totalQty > 0 ? "inline-block" : "none";
    }
    
    // ðŸ”¥ IMPORTANT: run AFTER navbar is loaded
    window.addEventListener("DOMContentLoaded", () => {
        updateCartCount();
    });
    
    // ðŸ”¥ Sync if cart updates in another page/tab
    window.addEventListener("storage", updateCartCount);
</script>
</html>
